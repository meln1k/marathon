<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Health Checks</title>
    <link rel="icon" type="image/x-icon" href="/marathon/1.1/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/1.1/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon/1.1/">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/1.1/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/1.1/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/1.1//search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
  <div class="col-sm-3">
    <h5>Welcome</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/">
          Getting Started
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/contributing.html">
          Contributing
        </a>
      </li>
    </ul>
    <hr>
    <h5>Guides</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/application-basics.html">
          Application Basics
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/blue-green-deploy.html">
          Blue-Green Deployment
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/developing-vm.html">
          Developing Marathon in a VM
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/service-discovery-load-balancing.html">
          Discovery &amp; Load Balancing
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/ssl-basic-access-authentication.html">
          SSL &amp; Basic Authentication
        </a>
      </li>
    </ul>
    <hr>
    <h5>Reference</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/application-groups.html">
          Application Groups
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/artifact-store.html">
          Artifact Store
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/command-line-flags.html">
          Command Line Flags
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/constraints.html">
          Constraints
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/deployments.html">
          Deployments
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/native-docker.html">
          Docker Containers
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/event-bus.html">
          Event Bus
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/framework-authentication.html">
          Framework Authentication
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/health-checks.html">
          Health Checks
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/high-availability.html">
          High Availability
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/ip-per-task.html">
          IP-per-task
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/marathon-ui.html">
          Marathon UI
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/metrics.html">
          Metrics
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/plugin.html">
          Plugins
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/ports.html">
          Ports
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/native-docker-private-registry.html">
          Private Docker Registries
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/recipes.html">
          Recipes
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/generated/api.html">
          REST API
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/rest-api.html">
          REST API (deprecated)
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/setup.html">
          Setup Recommendations for Marathon
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/persistent-volumes.html">
          Stateful Applications Using Local Persistent Volumes
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/task-environment-vars.html">
          Task Environment Variables
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/troubleshooting.html">
          Troubleshooting
        </a>
      </li>
    </ul>
    <hr>
    <h5>Development</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/core-architecture.html">
          New Core Architecture
        </a>
      </li>
    </ul>
    <hr>
    <h5>Upgrading</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/upgrade/index.html">
          Upgrading to a Newer Version
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/upgrade/06xto070.html">
          0.6.x to 0.7.0
        </a>
      </li>
    </ul>
  </div>
  <div class="col-sm-9">
    <h1 id="health-checks">Health Checks</h1>

<p>Health checks may be specified per application to be run against that application’s tasks.</p>

<ul>
  <li>The default health check defers to Mesos’ knowledge of the task state <code class="highlighter-rouge">TASK_RUNNING =&gt; healthy</code></li>
  <li>Marathon provides a <code class="highlighter-rouge">health</code> member of the task resource
via the <a href="/marathon/1.1/docs/rest-api.html">REST API</a>.</li>
</ul>

<p>A health check is considered passing if (1) its HTTP response code is between
200 and 399, inclusive, and (2) its response is received within the
<code class="highlighter-rouge">timeoutSeconds</code> period. If a task fails more than <code class="highlighter-rouge">maxConsecutiveFailures</code> health
checks consecutively, that task is killed.</p>

<h5 id="example-usage">Example usage</h5>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/health"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"portIndex"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HTTP"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"gracePeriodSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
  </span><span class="nt">"intervalSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
  </span><span class="nt">"timeoutSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
  </span><span class="nt">"maxConsecutiveFailures"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nt">"ignoreHttp1xx"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>OR</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"portIndex"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TCP"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"gracePeriodSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
  </span><span class="nt">"intervalSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
  </span><span class="nt">"timeoutSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
  </span><span class="nt">"maxConsecutiveFailures"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>OR</p>

<p><em>Note:</em> Command health checks in combination with dockerized tasks were
broken in Mesos v0.23.0 and v0.24.0. This issue has been fixed in
v0.23.1 and v0.24.1.</p>

<p>See <a href="https://issues.apache.org/jira/browse/MESOS-3136">MESOS-3136</a> for
more details.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMMAND"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"command"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"curl -f -X GET http://$HOST:$PORT0/health"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nt">"gracePeriodSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w">
  </span><span class="nt">"intervalSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
  </span><span class="nt">"timeoutSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
  </span><span class="nt">"maxConsecutiveFailures"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="health-check-options">Health check options</h4>

<p>The first thing you need to decide is the protocol of your health check:</p>

<ul>
  <li><code class="highlighter-rouge">protocol</code> (Optional. Default: “HTTP”): Protocol of the requests to be
performed. One of “HTTP”/”TCP”/”COMMAND”.</li>
</ul>

<p>HTTP/TCP health checks are executed by Marathon and thus test the reachability from
the current Marathon leader. COMMAND health checks are locally executed by Mesos on
the agent running the corresponding task.</p>

<p>Options applicable to every protocol:</p>

<ul>
  <li><code class="highlighter-rouge">gracePeriodSeconds</code> (Optional. Default: 300): Health check failures are
ignored within this number of seconds or until the task becomes healthy for
the first time.</li>
  <li><code class="highlighter-rouge">intervalSeconds</code> (Optional. Default: 60): Number of seconds to wait between
health checks.</li>
  <li><code class="highlighter-rouge">maxConsecutiveFailures</code>(Optional. Default: 3): Number of consecutive health
check failures after which the unhealthy task should be killed. If this value
is <code class="highlighter-rouge">0</code>, then tasks will not be killed due to failing this check.</li>
  <li><code class="highlighter-rouge">timeoutSeconds</code> (Optional. Default: 20): Number of seconds after which a
health check is considered a failure regardless of the response.</li>
</ul>

<p>For TCP/HTTP health checks, either <code class="highlighter-rouge">port</code> or <code class="highlighter-rouge">portIndex</code> may be used. If none is provided, <code class="highlighter-rouge">portIndex</code> is assumed. If <code class="highlighter-rouge">port</code> is provided, it takes precedence overriding any <code class="highlighter-rouge">portIndex</code> option.</p>

<ul>
  <li><code class="highlighter-rouge">portIndex</code> (Optional. Default: 0): Index in this app’s <code class="highlighter-rouge">ports</code> or
<code class="highlighter-rouge">portDefinitions</code> array to be used for health requests. An index is used
so the app can use random ports, like <code class="highlighter-rouge">[0, 0, 0]</code> for example, and tasks
could be started with port environment variables like <code class="highlighter-rouge">$PORT1</code>.</li>
  <li><code class="highlighter-rouge">port</code> (Optional. Default: None): Port number to be used for health requests.</li>
</ul>

<p>The following options only apply to HTTP health checks:</p>

<ul>
  <li><code class="highlighter-rouge">path</code> (Optional. Default: “/”): Path to endpoint exposed by the task that
will provide health  status. Example: “/path/to/health”.</li>
  <li><code class="highlighter-rouge">ignoreHttp1xx</code> (Optional. Default: false): Ignore HTTP informational status
codes 100 to 199. If the HTTP health check returns one of these, the result is
discarded and the health status of the task remains unchanged.</li>
</ul>

<h4 id="health-lifecycle">Health Lifecycle</h4>

<p>The application health lifecycle is represented by the finite state machine in figure 1 below.  In the diagram:</p>

<ul>
  <li><code class="highlighter-rouge">i</code> is the number of requested instances</li>
  <li><code class="highlighter-rouge">r</code> is the number of running instances</li>
  <li><code class="highlighter-rouge">h</code> is the number of healthy instances</li>
</ul>

<p class="text-center">
  <img src="/marathon/1.1/img/app-state.png" width="481" height="797" alt="" /><br />
  <em>Figure 1: The Application Health Lifecycle</em>
</p>

  </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2016 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: IP-per-task</title>
    <link rel="icon" type="image/x-icon" href="/marathon/1.1/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/1.1/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon/1.1/">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/1.1/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/1.1/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/1.1//search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
  <div class="col-sm-3">
    <h5>Welcome</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/">
          Getting Started
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/contributing.html">
          Contributing
        </a>
      </li>
    </ul>
    <hr>
    <h5>Guides</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/application-basics.html">
          Application Basics
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/blue-green-deploy.html">
          Blue-Green Deployment
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/developing-vm.html">
          Developing Marathon in a VM
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/service-discovery-load-balancing.html">
          Discovery &amp; Load Balancing
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/ssl-basic-access-authentication.html">
          SSL &amp; Basic Authentication
        </a>
      </li>
    </ul>
    <hr>
    <h5>Reference</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/application-groups.html">
          Application Groups
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/artifact-store.html">
          Artifact Store
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/command-line-flags.html">
          Command Line Flags
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/constraints.html">
          Constraints
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/deployments.html">
          Deployments
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/native-docker.html">
          Docker Containers
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/event-bus.html">
          Event Bus
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/framework-authentication.html">
          Framework Authentication
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/health-checks.html">
          Health Checks
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/high-availability.html">
          High Availability
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/ip-per-task.html">
          IP-per-task
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/marathon-ui.html">
          Marathon UI
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/metrics.html">
          Metrics
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/plugin.html">
          Plugins
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/ports.html">
          Ports
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/native-docker-private-registry.html">
          Private Docker Registries
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/recipes.html">
          Recipes
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/generated/api.html">
          REST API
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/rest-api.html">
          REST API (deprecated)
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/setup.html">
          Setup Recommendations for Marathon
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/persistent-volumes.html">
          Stateful Applications Using Local Persistent Volumes
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/task-environment-vars.html">
          Task Environment Variables
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/troubleshooting.html">
          Troubleshooting
        </a>
      </li>
    </ul>
    <hr>
    <h5>Development</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/core-architecture.html">
          New Core Architecture
        </a>
      </li>
    </ul>
    <hr>
    <h5>Upgrading</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/1.1/docs/upgrade/index.html">
          Upgrading to a Newer Version
        </a>
      </li>
      <li>
        <a href="/marathon/1.1/docs/upgrade/06xto070.html">
          0.6.x to 0.7.0
        </a>
      </li>
    </ul>
  </div>
  <div class="col-sm-9">
    <h1 id="ip-per-task">IP-per-task</h1>

<div class="alert alert-danger" role="alert">
  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Available in Marathon Version 0.14.0+ <br />
    The IP-per-task functionality is considered experimental, so use this
    feature at your own risk. We might add, change, or delete any
    functionality described in this document, including the API. We
    appreciate <a href="https://github.com/mesosphere/marathon/issues/2709">your feedback</a> !
</div>

<p>In version 0.14, Marathon introduced experimental IP-per-task support. With the appropriate configuration,
every tasks of an app gets its own network interface and IP address.</p>

<p>This can drastically simplify service discovery, since you can use
<a href="https://github.com/mesosphere/mesos-dns">mesos-dns</a> to rely on DNS for service discovery. This enables your
applications to use address-only (A) DNS records in combination with known ports to connect to other
services – as you would do it in a traditional static cluster environment.</p>

<p>You can request an IP-per-task with default settings like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"/i-have-my-own-ip"</span><span class="p">,</span>
  <span class="c1">// ... more settings ...</span>
  <span class="s2">"ipAddress"</span><span class="err">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Marathon passes down the request for the IP to Mesos. You have to make sure that you installed &amp; configured
the appropriate
<a href="https://docs.google.com/document/d/17mXtAmdAXcNBwp_JfrxmZcQrs7EO6ancSbejrqjLQ0g">Network Isolation Modules</a> &amp;
IP Access Manager (IPAM) modules in Mesos. The Marathon support for this feature requires Mesos v0.26.</p>

<p>If an application requires IP-per-task, then it can not request ports to be allocated in the slave.</p>

<p>Currently, this feature does not work in combination with Docker containers. We might still change some
aspects of the API and we appreciate your feedback.</p>

<h2 id="network-security-groups">Network security groups</h2>

<p>If your IP Access Manager (IPAM) supports it, you can refine your IP configuration using network security
groups and labels:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"/i-have-my-own-ip"</span><span class="p">,</span>
  <span class="c1">// ... more settings ...</span>
  <span class="s2">"ipAddress"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"groups"</span><span class="err">:</span> <span class="p">[</span><span class="s2">"production"</span><span class="p">],</span>
    <span class="s2">"labels"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"some-meaningful-config"</span><span class="err">:</span> <span class="s2">"potentially interpreted by the IPAM"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Network security groups only allow network traffic between tasks that have at least one of their configured
groups in common. This makes it easy to disallow your staging environment to interfere with production
traffic.</p>

<h2 id="service-discovery">Service Discovery</h2>

<p>If your application requires IP-per-task, then it can not request ports to be allocated in the slave. It is
however still possible to describe the ports that the Application’s tasks expose:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"/i-have-my-own-ip"</span><span class="p">,</span>
  <span class="c1">// ... more settings ...</span>
  <span class="s2">"ipAddress"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"discovery"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"ports"</span><span class="err">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">"number"</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"http"</span><span class="p">,</span> <span class="s2">"protocol"</span><span class="p">:</span> <span class="s2">"tcp"</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
      <span class="c1">// ... more settings ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Marathon will pass down this information to Mesos (inside the DiscoveryInfo message) when starting new tasks,
<a href="https://github.com/mesosphere/mesos-dns">mesos-dns</a> will then expose this information through IN SRV records.</p>

  </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2016 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>
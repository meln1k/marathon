<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Fault Domain Awareness and Capacity Extension</title>
    <link rel="icon" type="image/x-icon" href="/marathon/1.6/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/1.6/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/1.6/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/1.6/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/1.6/search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/networking.html">
                    Networking
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/pods.html">
                    Pods
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/native-docker.html">
                    Provisioning Containers
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/task-handling.html">
                    Task Handling
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/configure-task-handling.html">
                    Task Handling Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/secrets.html">
                    Secret Configuration
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/backup-restore.html">
                    Backup and Restore
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/data-migration.html">
                    Data Migration
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/maintenance-mode.html">
                    Maintenance mode
                </a>
            </li>
        </ul>

        <h5>Upgrading</h5>
        <ul class="list-unstyled">
          <li>
              <a href="/marathon/1.6/docs/upgrade/index.html">
                  Upgrading to a new Version
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/network-api-for-apps.html">
                  Migrating Apps to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/network-api-migration.html">
                  Migrating Tools to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/versioning.html">
                  Versioning
              </a>
          </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/waiting.html">
                   Stuck App or Pod Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/cfs.html">
                    Slow Docker apps and deployments
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/1.6/api-console/index.html">REST API Reference</a>
        </li>
        </ul>
        <h5>Docs for Previous Versions</h5>
        <ul class="list-unstyled">
            
            <li><a href="/marathon/1.6/docs">Version 1.6.x</a></li>
            
            <li><a href="/marathon/1.5/docs">Version 1.5.x</a></li>
            
            <li><a href="/marathon/1.4/docs">Version 1.4.x</a></li>
            
        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="fault-domain-awareness">Fault Domain Awareness</h1>

<h2 id="overview">Overview</h2>

<p>A fault domain is a section of a network, for example, a rack in a datacenter or an entire datacenter, that is vulnerable to damage if a critical device or system fails. All instances within a fault domain share similar failure and latency characteristics. App or pod instances in the same fault domain are all affected by failure events within the domain. Placing instances in more than one fault domain reduces the risk that a failure will affect all instances.</p>

<p>Marathon supports fault domain awareness. Use fault domain awareness to make your apps or pods highly available and to allow for increased capacity when needed.</p>

<p>Marathon currently supports Mesos’s 2-level hierarchical fault domains: zone and region.</p>

<h2 id="zone-fault-domains">Zone fault domains</h2>
<p>Zone fault domains offer a moderate degree of fault isolation because they share the same region. However, network latency between zones in the same region is moderately low (typically &lt; 10ms).</p>

<p>For on-premise deployments, a zone would be a physical data center rack.</p>

<p>For public cloud deployments, a zone would be the “availability zone” concept provided by most cloud providers.</p>

<p>If your goal is high-availability, and/or you are latency-sensitive, place your instances in a one region and balance them across zones.</p>

<h2 id="region-fault-domains">Region fault domains</h2>

<p>Region fault domains offer the most fault isolation, though inter-region network latency is high (typically 50-100ms ).</p>

<p>For on-premise deployments, a region might be a data center.</p>

<p>For public cloud deployments, most cloud providers expose a “region” concept.</p>

<p>You can deploy your instances in a specific region region based on the available capacity.</p>

<h3 id="local-and-remote-regions">Local and remote regions</h3>

<ul>
  <li>The <strong>local region</strong> is the region running the Mesos master nodes.</li>
  <li>A <strong>remote region</strong> contains only Mesos agent nodes. There is usually high latency between a remote region and the local region.</li>
</ul>

<h2 id="mesos-installation-considerations">Mesos installation considerations</h2>

<ul>
  <li>Mesos master nodes must be in the same region because otherwise the latency between them will be too high. They should, however, be spread across zones for fault-tolerance.</li>
  <li>Marathon must run in the local region.</li>
  <li>You must have less than 100 ms latency between regions.</li>
</ul>

<h2 id="adding-fault-domain-awareness-to-your-app-or-pod-definition">Adding fault domain awareness to your app or pod definition</h2>

<p>In your Marathon app or pod definition, you can use <a href="/marathon/1.6/docs/constraints.html">placement constraints</a>to:</p>

<ul>
  <li>
    <p>Specify a region and zone for your app or pod instances, so that all instances will be scheduled only in that region and zone.</p>
  </li>
  <li>
    <p>Specify a region without a specific zone, so that all instances will be scheduled in that region (but not necessarily in the same zone).</p>
  </li>
</ul>

<h3 id="placement-constraint-guidelines">Placement constraint guidelines</h3>

<ul>
  <li>
    <p>If no region is specified in your app or pod definition, instances are only scheduled for the local region because of high latency between the local and remote region. No instance will ever be scheduled for an agent outside of the local region unless you explicitly specify.</p>
  </li>
  <li>
    <p>If a region is specified without a specific zone, instances are scheduled on any agent in the given region.</p>
  </li>
  <li>
    <p>If both region and zone are specified, instances are scheduled on any agent in the given region and zone, and not in any other region or zone.</p>
  </li>
  <li>
    <p>If you specify a hostname <code class="highlighter-rouge">UNIQUE</code> constraint, that constraint is also honored in remote regions.</p>
  </li>
</ul>

<h3 id="examples">Examples</h3>

<p>Suppose we have a Mesos cluster that spans 3 regions: <code class="highlighter-rouge">aws-us-east1</code>, <code class="highlighter-rouge">aws-us-east2</code>, and <code class="highlighter-rouge">local</code>. Each region has zones <code class="highlighter-rouge">a</code>,<code class="highlighter-rouge">b</code>,<code class="highlighter-rouge">c</code>,<code class="highlighter-rouge">d</code>.</p>

<h4 id="specify-only-a-remote-region">Specify only a remote region</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"instances"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="nt">"constraints"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">[</span><span class="s2">"@region"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"aws-us-east1"</span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<ul>
  <li>No instance will launch in the local region.</li>
  <li>All of the 5 instances will be launched in the <code class="highlighter-rouge">aws-us-east1</code> region.</li>
</ul>

<h4 id="balanced-placement-for-a-single-region----add-to-constraints-page--hostname--">Balanced Placement for a Single Region <!-- add to constraints page , @hostname--></h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
   </span><span class="err">...</span><span class="w">
  </span><span class="nt">"instances"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
  </span><span class="nt">"constraints"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">[</span><span class="s2">"@region"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IS"</span><span class="p">,</span><span class="w"> </span><span class="s2">"aws-us-east1"</span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="s2">"@zone"</span><span class="p">,</span><span class="w"> </span><span class="s2">"GROUP_BY"</span><span class="p">,</span><span class="w"> </span><span class="s2">"4"</span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<ul>
  <li>Instances will all be launched in the <code class="highlighter-rouge">aws-us-east1</code> region and evenly divided between <code class="highlighter-rouge">aws-us-east1</code>‘s zones <code class="highlighter-rouge">a</code>,<code class="highlighter-rouge">b</code>,<code class="highlighter-rouge">c</code>,<code class="highlighter-rouge">d</code>.</li>
</ul>

<h3 id="increase-cluster-capacity">Increase Cluster Capacity</h3>

<p>To increase capacity, <a href="1.11/administering-clusters/add-a-node/">add new agents</a> to a remote region or regions of your cluster, and then update your services to launch instances in that region or those regions appropriately.</p>

<p><strong>Note:</strong> You cannot configure your service to run in more than one region.</p>

    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2018 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Preferential GPU Scheduling</title>
    <link rel="icon" type="image/x-icon" href="/marathon/1.6/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/1.6/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/1.6/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/1.6/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/1.6/search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/networking.html">
                    Networking
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/pods.html">
                    Pods
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/native-docker.html">
                    Provisioning Containers
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/task-handling.html">
                    Task Handling
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/configure-task-handling.html">
                    Task Handling Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/secrets.html">
                    Secret Configuration
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/backup-restore.html">
                    Backup and Restore
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/data-migration.html">
                    Data Migration
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/maintenance-mode.html">
                    Maintenance mode
                </a>
            </li>
        </ul>

        <h5>Upgrading</h5>
        <ul class="list-unstyled">
          <li>
              <a href="/marathon/1.6/docs/upgrade/index.html">
                  Upgrading to a new Version
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/network-api-for-apps.html">
                  Migrating Apps to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/network-api-migration.html">
                  Migrating Tools to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/versioning.html">
                  Versioning
              </a>
          </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/waiting.html">
                   Stuck App or Pod Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/cfs.html">
                    Slow Docker apps and deployments
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/1.6/api-console/index.html">REST API Reference</a>
        </li>
        </ul>
        <h5>Docs for Previous Versions</h5>
        <ul class="list-unstyled">
            
            <li><a href="/marathon/1.6/docs">Version 1.6.x</a></li>
            
            <li><a href="/marathon/1.5/docs">Version 1.5.x</a></li>
            
            <li><a href="/marathon/1.4/docs">Version 1.4.x</a></li>
            
        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="preferential-gpu-scheduling">Preferential GPU Scheduling</h1>

<h2 id="overview-of-gpu-scheduling-in-marathon">Overview of GPU Scheduling in Marathon</h2>

<p>Marathon supports launching GPU tasks when the command-line option <code class="highlighter-rouge">--enable_features gpu_resources</code> is specified. Depending on the GPU availability, it may be desirable to configure Marathon to avoid placing non-GPU tasks on GPU nodes.</p>

<h2 id="parameters-in-marathon--mesos">Parameters in Marathon / Mesos</h2>

<p>In order to enable GPU support in your cluster, you should be cognizant configure the following command-line launch parameters for Mesos and Marathon.</p>

<p>Mesos Master:</p>

<ul>
  <li><code class="highlighter-rouge">--filter_gpu_resources</code> - Only send offers for nodes containing GPUs to frameworks that opt-in to GPU resources (e.g. <code class="highlighter-rouge">marathon --enable_features gpu_resources</code>).</li>
  <li><code class="highlighter-rouge">--no-filter_gpu_resources</code> - Send offers for nodes containing GPUs to all frameworks, regardless of GPU opt-in status.</li>
</ul>

<p>Marathon:</p>

<ul>
  <li><code class="highlighter-rouge">--enable_features gpu_resources</code> - Tell Mesos that Marathon should be offered GPU resources. (See the <a href="./command-line-flags.html">command-line docs</a>).</li>
  <li><code class="highlighter-rouge">--gpu_scheduling_behavior</code> - Defines how offered GPU resources should be treated. Possible settings:
    <ul>
      <li><code class="highlighter-rouge">unrestricted</code> (Default) - non-GPU tasks are launched irrespective of offers containing GPUs.</li>
      <li><code class="highlighter-rouge">undefined</code> - The same as <code class="highlighter-rouge">unrestricted</code>, but logs a warning when a GPU resource containing offer is used for a non-GPU task.</li>
      <li><code class="highlighter-rouge">restricted</code> - non-GPU tasks will decline offers containing GPUs. A decline reason of <code class="highlighter-rouge">DeclinedScareResources</code> is given.</li>
    </ul>
  </li>
</ul>

<h2 id="enumeration-of-different-possible-cluster-scenarios">Enumeration of Different Possible Cluster Scenarios</h2>

<p>You may fall under one of the following configuration scenarios:</p>

<ol>
  <li><strong>No GPUs</strong></li>
  <li><strong>Scarce GPUs</strong> - only a few nodes have GPUs.</li>
  <li><strong>Abundant GPUs</strong> - most or every node has a GPU.</li>
</ol>

<p>Further, if your cluster has GPUs:</p>

<p>a. Marathon will directly launch GPU tasks (and, perhaps, also launch frameworks that launch GPU tasks).
b. Marathon will <strong>not</strong> launch GPU tasks - While Marathon may launch a GPU framework (such as Tensorflow) which launches GPU tasks, Marathon will not directly launch GPU tasks itself.</p>

<p>If GPUs are abundant, Marathon should be able to place non-GPU tasks on nodes containing GPUs. Otherwise, you might risk not being able to deploy non-GPU tasks.</p>

<p>If GPUs are scarce, Marathon should avoid placing non-GPU tasks on nodes containing GPUs. Otherwise, GPU tasks may not launch if the memory/CPU resources on GPU containing nodes are consumed by non-GPU tasks.</p>

<p>With that in mind, the following list of scenarios and suggested GPU param configuration should help guide your cluster configuration:</p>

<ul>
  <li>(1 ) No GPUs
    <ul>
      <li><code class="highlighter-rouge">mesos-master ...</code></li>
      <li><code class="highlighter-rouge">marathon ...</code></li>
    </ul>
  </li>
  <li>(2a) Scarce GPUs, Marathon will directly launch GPU tasks
    <ul>
      <li><code class="highlighter-rouge">mesos-master --filter_gpu_resources ...</code></li>
      <li><code class="highlighter-rouge">marathon --enable_features gpu_resources --gpu_scheduling_behavior restricted ...</code></li>
    </ul>
  </li>
  <li>(2b) Scarce GPUs, Marathon will <strong>not</strong> launch GPU tasks
    <ul>
      <li><code class="highlighter-rouge">mesos-master --filter_gpu_resources ...</code></li>
      <li><code class="highlighter-rouge">marathon ...</code></li>
    </ul>
  </li>
  <li>(3a) Abundant GPUs, Marathon will directly launch GPU tasks
    <ul>
      <li><code class="highlighter-rouge">mesos-master --no-filter_gpu_resources ...</code></li>
      <li><code class="highlighter-rouge">marathon --enable_features gpu_resources --gpu_scheduling_behavior unrestricted ...</code></li>
    </ul>
  </li>
  <li>(3b) Abundant GPUs, Marathon will <strong>not</strong> launch GPU tasks
    <ul>
      <li><code class="highlighter-rouge">mesos-master --no-filter_gpu_resources ...</code></li>
      <li><code class="highlighter-rouge">marathon ...</code></li>
    </ul>
  </li>
</ul>

<h2 id="caveats--edge-cases">Caveats / Edge Cases</h2>

<p>Please be aware of the important following edge cases applicable to Marathon <code class="highlighter-rouge">--gpu_scheduling_behavior restricted</code></p>

<h3 id="nodes-that-have-all-gpus-consumed-treated-as-non-gpu-nodes">Nodes That Have All GPUs Consumed Treated as Non-GPU Nodes</h3>

<p>When a GPU node has all GPU resources consumed (either reserved for other roles, or used by running tasks), Marathon will treat it as a non-GPU node and will proceed to place non-GPU tasks on it. This is because makes GPU placement decisions based off of resources offered, and if no GPUs are available for the role as which Marathon is registered, or the role <code class="highlighter-rouge">*</code>, then Marathon will see no GPUs.</p>

<p>If you reserve your GPUs for a non-Marathon role (e.g. Tensorflow), be sure to reserve CPU, disc, and memory resources, also for that role.</p>

<h3 id="non-gpu-resident-tasks-will-ignore-gpu-scheduling-behavior-when-relaunching">Non-GPU Resident Tasks Will Ignore GPU Scheduling Behavior When Relaunching</h3>

<p>If a resident task (has persistent volumes) that does not use GPUs is launched on a GPU resource containing node, then it will be relaunched, regardless of the setting of <code class="highlighter-rouge">--gpu_scheduling_behavior</code>. A resident task could launch on a GPU resource node, even though <code class="highlighter-rouge">--gpu_scheduling_behavior restricted</code> specified under the following scenarios:</p>

<ol>
  <li>The resident task is launched while the <code class="highlighter-rouge">--gpu_scheduling_behavior restricted</code> is unset, and then the flag is changed and Marathon is restarted.</li>
  <li>The resident task is launched while all GPU resources on the GPU node are consumed (as outlined in the prior caveat).</li>
</ol>

    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2018 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>
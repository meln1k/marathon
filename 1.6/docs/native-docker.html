<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Provisioning Containers</title>
    <link rel="icon" type="image/x-icon" href="/marathon/1.6/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/1.6/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/1.6/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/1.6/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/1.6/search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/networking.html">
                    Networking
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/pods.html">
                    Pods
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/native-docker.html">
                    Provisioning Containers
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/task-handling.html">
                    Task Handling
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/configure-task-handling.html">
                    Task Handling Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/secrets.html">
                    Secret Configuration
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/backup-restore.html">
                    Backup and Restore
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/data-migration.html">
                    Data Migration
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/maintenance-mode.html">
                    Maintenance mode
                </a>
            </li>
        </ul>

        <h5>Upgrading</h5>
        <ul class="list-unstyled">
          <li>
              <a href="/marathon/1.6/docs/upgrade/index.html">
                  Upgrading to a new Version
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/network-api-for-apps.html">
                  Migrating Apps to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/network-api-migration.html">
                  Migrating Tools to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.6/docs/upgrade/versioning.html">
                  Versioning
              </a>
          </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/waiting.html">
                   Stuck App or Pod Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/cfs.html">
                    Slow Docker apps and deployments
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.6/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/1.6/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/1.6/api-console/index.html">REST API Reference</a>
        </li>
        </ul>
        <h5>Docs for Previous Versions</h5>
        <ul class="list-unstyled">
            
            <li><a href="/marathon/1.6/docs">Version 1.6.x</a></li>
            
            <li><a href="/marathon/1.5/docs">Version 1.5.x</a></li>
            
            <li><a href="/marathon/1.4/docs">Version 1.4.x</a></li>
            
        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="provisioning-containers">Provisioning Containers</h1>

<p>A containerizer is a Mesos agent component responsible for launching containers, within which you can run a Marathon app. Running apps in containers offers a number of benefits, including the ability to isolate tasks from one another and control task resources programmatically.</p>

<p>Marathon enables users to launch containers with container images using two different runtimes:</p>

<ol>
  <li>Mesos containerizer using the <a href="#ucr">Universal Container Runtime</a>.</li>
  <li><a href="#docker-containerizer">Docker containerizer</a> using the native Docker Engine as runtime.</li>
</ol>

<p><a name="ucr"></a></p>

<h1 id="universal-container-runtime">Universal Container Runtime</h1>

<p>The <a href="http://mesos.apache.org/documentation/latest/container-image">Universal Container Runtime</a> (UCR) extends the Mesos containerizer to support provisioning <a href="https://docker.com/">Docker</a> container images (<a href="https://github.com/appc/spec">AppC</a> coming soon). This means that you can use both the Mesos containerizer and other container image types. You can still use the Docker container runtime directly (<a href="#docker-containerizer">instructions are below</a>), but the Universal Container Runtime supports running Docker images without depending on the Docker Engine, which allows for better integration with Mesos.</p>

<p>The following Marathon features <em>only</em> work with the UCR:</p>

<ul>
  <li><a href="/marathon/1.6/docs/pods.html">Pods</a>.</li>
  <li>GPUs.</li>
  <li><a href="/marathon/1.6/docs/native-docker-private-registry.html">Authentication to a private Docker registry using a secret store</a>.</li>
</ul>

<h2 id="provisioning-containers-with-the-ucr">Provisioning Containers with the UCR</h2>

<p>To provision containers with the UCR, specify the container type <code class="highlighter-rouge">MESOS</code> and a the appropriate object in your application definition. Here, we specify a Docker container with the <code class="highlighter-rouge">docker</code> object.</p>

<p>The UCR containerizer provides a <code class="highlighter-rouge">pullConfig</code> parameter with a <code class="highlighter-rouge">secret</code> field for <a href="/marathon/1.6/docs/native-docker-private-registry.html">authentication with a private Docker registry</a>.</p>

<p><code class="highlighter-rouge">credential</code>, with a <code class="highlighter-rouge">principal</code> and an optional <code class="highlighter-rouge">secret</code> field to authenticate when downloading the Docker image.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">  
   </span><span class="nt">"id"</span><span class="p">:</span><span class="s2">"mesos-docker"</span><span class="p">,</span><span class="w">
   </span><span class="nt">"container"</span><span class="p">:{</span><span class="w">  
      </span><span class="nt">"docker"</span><span class="p">:{</span><span class="w">  
         </span><span class="nt">"image"</span><span class="p">:</span><span class="s2">"mesosphere/inky"</span><span class="p">,</span><span class="w">
         </span><span class="nt">"pullConfig"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pullConfigSecret"</span><span class="w">
          </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="s2">"MESOS"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nt">"secrets"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"pullConfigSecret"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"source"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/mesos-docker/pullConfig"</span><span class="w">
        </span><span class="p">}</span><span class="w">
   </span><span class="s2">"args"</span><span class="err">:</span><span class="p">[</span><span class="w">  
      </span><span class="s2">"&lt;my-arg&gt;"</span><span class="w">
   </span><span class="p">],</span><span class="w">
   </span><span class="nt">"cpus"</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span><span class="w">
   </span><span class="nt">"mem"</span><span class="p">:</span><span class="mf">16.0</span><span class="p">,</span><span class="w">
   </span><span class="nt">"instances"</span><span class="p">:</span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p><strong>Important:</strong> If you leave the <code class="highlighter-rouge">args</code> field empty, the default entry point will be the launch command for the container. If your container does not have a default entry point, you must specify a command in the <code class="highlighter-rouge">args</code> field. If you do not, your app will fail to deploy.</p>

<h2 id="ucr-limitations">UCR Limitations</h2>
<ul>
  <li>The UCR does not support the following: runtime privileges, Docker options.</li>
</ul>

<p><a name="docker-containerizer"></a></p>

<h1 id="provisioning-containers-with-the-docker-containerizer">Provisioning Containers with the Docker Containerizer</h1>

<p>The Docker containerizer relies on the external Docker engine runtime to provision the containers.</p>

<h2 id="configuration">Configuration</h2>

<p>DC/OS clusters are already configured to run Docker containers, so
DC/OS users do not need to follow the configuration steps below.</p>

<h4 id="prerequisites">Prerequisites</h4>

<ul>
  <li>Docker version 1.0.0 or later installed on each agent node.</li>
</ul>

<h4 id="configure-the-agent-process">Configure the Agent Process</h4>

<div class="alert alert-info">
    <strong>Note:</strong> All commands below assume the Mesos agent process is being run
    as a service using the package provided by
    <a href="http://mesosphere.com/2014/07/17/mesosphere-package-repositories/">Mesosphere</a>
  </div>

<ol>
  <li>Update your agent node configuration to specify the use of the Docker containerizer</li>
</ol>
<div class="alert alert-info">
    <strong>Note:</strong> The order of the parameters to `containerizers` is important.
    It specifies the priority used when choosing the containerizer to launch
    the task.
  </div>

<div class="highlighter-rouge"><pre class="highlight"><code>```bash
$ echo 'docker,mesos' &gt; /etc/mesos-slave/containerizers
```
</code></pre>
</div>

<ol>
  <li>
    <p>Increase the executor timeout to account for the potential delay pulling a docker image to the agent node.</p>

    <p><code class="highlighter-rouge">bash
 $ echo '10mins' &gt; /etc/mesos-slave/executor_registration_timeout
</code></p>
  </li>
  <li>
    <p>Restart the agent process to load the new configuration.</p>
  </li>
</ol>

<h4 id="configure-marathon">Configure Marathon</h4>

<p>Increase the Marathon <a href="/marathon/1.6/docs/command-line-flags.html">command line option</a></p>

<p><code class="highlighter-rouge">--task_launch_timeout</code> to at least the executor timeout, in milliseconds,
you set on your agent nodes in the previous step.</p>

<h2 id="overview">Overview</h2>

<p>To use the native container support, add a <code class="highlighter-rouge">container</code> field to your
app definition JSON:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"container"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCKER"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"docker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"network"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HOST"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"group/image"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"volumes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"containerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/etc/a"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hostPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/data/a"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RO"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nt">"containerPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/etc/b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hostPath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/data/b"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RW"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>where <code class="highlighter-rouge">volumes</code> and <code class="highlighter-rouge">type</code> are optional (the default type is <code class="highlighter-rouge">DOCKER</code>).  More
container types may be added later.</p>

<p>For convenience, the mount point of the Mesos sandbox is available in the
environment as <code class="highlighter-rouge">$MESOS_SANDBOX</code>.</p>

<h3 id="bridged-networking-mode">Bridged Networking Mode</h3>

<p><em>Note: Requires Mesos 0.20.1 and Marathon 0.7.1</em></p>

<p>Bridged networking makes it easy to run programs that bind to statically
configured ports in Docker containers. Marathon can “bridge” the gap between
the port resource accounting done by Mesos and the host ports that are bound
by Docker.</p>

<p><strong>Dynamic port mapping:</strong></p>

<p>Let’s begin by taking an example app definition:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bridged-webapp"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"cmd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python3 -m http.server 8080"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"cpus"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w">
  </span><span class="nt">"mem"</span><span class="p">:</span><span class="w"> </span><span class="mf">64.0</span><span class="p">,</span><span class="w">
  </span><span class="nt">"instances"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nt">"networks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"container/bridge"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nt">"container"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCKER"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"docker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python:3"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"portMappings"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nt">"containerPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">8080</span><span class="p">,</span><span class="w"> </span><span class="nt">"hostPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"servicePort"</span><span class="p">:</span><span class="w"> </span><span class="mi">9000</span><span class="p">,</span><span class="w"> </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tcp"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w"> </span><span class="nt">"containerPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">161</span><span class="p">,</span><span class="w"> </span><span class="nt">"hostPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"udp"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"healthChecks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HTTP"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"portIndex"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"gracePeriodSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"intervalSeconds"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w">
      </span><span class="nt">"maxConsecutiveFailures"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Here <code class="highlighter-rouge">"hostPort": 0</code> retains the traditional meaning in Marathon, which is “a
random port from the range included in the Mesos resource offer”. The resulting
host ports for each task are exposed via the task details in the REST API and
the Marathon web UI. <code class="highlighter-rouge">"hostPort"</code> is optional and defaults to <code class="highlighter-rouge">0</code>.</p>

<p>“containerPort” refers to the port the application listens to inside of the container.</p>

<p>Since <span class="label label-default">v0.9.0</span>: <code class="highlighter-rouge">"containerPort"</code> is optional and now defaults to <code class="highlighter-rouge">0</code>.
When <code class="highlighter-rouge">"containerPort": 0</code>, Marathon assigns
the container port the same value as the assigned <code class="highlighter-rouge">hostPort</code>. This is especially useful for apps that
advertise the port they are listening on to the outside world for P2P communication. Without “containerPort”: 0 they
would erroneously advertise their private container port which is usually not the same as the externally visible host
port.</p>

<p><code class="highlighter-rouge">"servicePort"</code> is a helper port intended for doing service discovery using
a well-known port per service.  The assigned <code class="highlighter-rouge">servicePort</code> value is not used/interpreted by Marathon itself but
supposed to be used by the load balancer infrastructure.
See <a href="/marathon/1.6/docs/service-discovery-load-balancing">Service Discovery Load Balancing doc page</a>.
The <code class="highlighter-rouge">servicePort</code> parameter is optional
and defaults to <code class="highlighter-rouge">0</code>.  Like <code class="highlighter-rouge">hostPort</code>, If the value is <code class="highlighter-rouge">0</code>, a random port will
be assigned.  If a <code class="highlighter-rouge">servicePort</code> value is assigned by Marathon then Marathon guarantees that its value
is unique across the cluster. The values for random service ports are in the
range <code class="highlighter-rouge">[local_port_min, local_port_max]</code> where <code class="highlighter-rouge">local_port_min</code> and
<code class="highlighter-rouge">local_port_max</code> are command line options with default values of <code class="highlighter-rouge">10000</code> and
<code class="highlighter-rouge">20000</code>, respectively.</p>

<p>The <code class="highlighter-rouge">"protocol"</code> parameter is optional and defaults to <code class="highlighter-rouge">"tcp"</code>. Its possible values are <code class="highlighter-rouge">"tcp"</code> and <code class="highlighter-rouge">"udp"</code>.</p>

<p><strong>Static port mapping:</strong></p>

<p>It’s also possible to specify non-zero host ports. When doing this
you must ensure that the target ports are included in some resource offers!
The Mesos agent node announces port resources in the range <code class="highlighter-rouge">[31000-32000]</code> by
default. This can be overridden; for example to also expose ports in the range
<code class="highlighter-rouge">[8000-9000]</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>--resources="ports(*):[8000-9000, 31000-32000]"
</code></pre>
</div>

<p>See the <a href="https://docs.docker.com/engine/userguide/networking/">network configuration</a>
documentation for more details on how Docker handles networking.</p>

<h3 id="using-a-private-docker-registry">Using a Private Docker Registry</h3>

<p>See the <a href="/marathon/1.6/docs/native-docker-private-registry.html">private registry</a>
documentation for more details on how to initiate a <code class="highlighter-rouge">docker pull</code> from a private docker registry
using Marathon.</p>

<h3 id="advanced-usage">Advanced Usage</h3>

<h4 id="forcing-a-docker-pull">Forcing a Docker Pull</h4>

<p>Marathon 0.8.2 with Mesos 0.22.0 supports an option to force Docker to pull
the image before launching each task.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCKER"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"docker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"group/image"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"forcePullImage"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="command-vs-args">Command vs Args</h4>

<p>As of version 0.7.0, Marathon supports an <code class="highlighter-rouge">args</code> field in the app JSON.  It is
invalid to supply both <code class="highlighter-rouge">cmd</code> and <code class="highlighter-rouge">args</code> for the same app.  The behavior of <code class="highlighter-rouge">cmd</code>
is as in previous releases (the value is wrapped by Mesos via
<code class="highlighter-rouge">/bin/sh -c '${app.cmd}</code>).</p>

<p>This new (<code class="highlighter-rouge">"args"</code>) mode of specifying a command allows for safe usage of
containerizer features like custom Docker <code class="highlighter-rouge">ENTRYPOINT</code>s.  For example, given
the following Dockerfile with an <code class="highlighter-rouge">ENTRYPOINT</code> defined:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>FROM busybox
LABEL <span class="nv">maintainer</span><span class="o">=</span><span class="s2">"support@mesosphere.io"</span>

CMD <span class="o">[</span><span class="s2">"inky"</span><span class="o">]</span>
ENTRYPOINT <span class="o">[</span><span class="s2">"echo"</span><span class="o">]</span>
</code></pre>
</div>

<p>Supplying the following app definition will download the public
<a href="https://registry.hub.docker.com/u/mesosphere/inky/">“mesosphere/inky” Docker container</a>
and execute <code class="highlighter-rouge">echo hello</code>:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"inky"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"container"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"docker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mesosphere/inky"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCKER"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"volumes"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"hello"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"cpus"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mem"</span><span class="p">:</span><span class="w"> </span><span class="mf">32.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"instances"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Named arguments can be passed as an array of consecutive <code class="highlighter-rouge">argc, argv</code> tuples,
e.g.:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w">   </span><span class="s2">"args"</span><span class="err">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="s2">"--name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"etcd0"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"--initial-cluster-state"</span><span class="p">,</span><span class="w"> </span><span class="s2">"new"</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span></code></pre>
</div>

<h4 id="privileged-mode-and-arbitrary-docker-options">Privileged Mode and Arbitrary Docker Options</h4>

<p>Starting with version 0.7.6, Marathon supports two new keys for docker
containers: <code class="highlighter-rouge">privileged</code> and <code class="highlighter-rouge">parameters</code>.  The <code class="highlighter-rouge">privileged</code> flag allows users
to run containers in privileged mode.  This flag is <code class="highlighter-rouge">false</code> by default.  The
<code class="highlighter-rouge">parameters</code> object allows users to supply arbitrary command-line options
for the <code class="highlighter-rouge">docker run</code> command executed by the Mesos containerizer.  Note that
any parameters passed in this manner are not guaranteed to be supported in
the future, as Mesos may not always interact with Docker via the CLI.</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"privileged-job"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"container"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"docker"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"image"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mesosphere/inky"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"privileged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nt">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="p">{</span><span class="w"> </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hostname"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a.corp.org"</span><span class="w"> </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w"> </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"volumes-from"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"another-container"</span><span class="w"> </span><span class="p">},</span><span class="w">
                </span><span class="p">{</span><span class="w"> </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lxc-conf"</span><span class="p">,</span><span class="w"> </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"DOCKER"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"volumes"</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"hello"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"cpus"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mem"</span><span class="p">:</span><span class="w"> </span><span class="mf">32.0</span><span class="p">,</span><span class="w">
    </span><span class="nt">"instances"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h1 id="resources">Resources</h1>

<ul>
  <li><a href="http://mesos.apache.org/documentation/latest/docker-containerizer">Mesos Docker Containerizer</a></li>
  <li>[Supporting Container Images in Mesos Containerizer]
(http://mesos.apache.org/documentation/latest/container-image/)</li>
</ul>

    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2018 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>